<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="lixh's blog"><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.4"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.4"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="stylesheet" type="text/css" href="https://unpkg.com/gitalk/dist/gitalk.css?v=2.0.4"><title>MySQL面试指南_笔记一 | lixh's blog</title></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">MySQL面试指南_笔记一</h1><a id="logo" href="/.">lixh's blog</a><p class="description">Learn and Share</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">MySQL面试指南_笔记一</h1><div class="post-meta"><a href="/2019/08/30/MySQL面试指南_笔记一/#comments" class="comment-count"></a><p><span class="date">Aug 30, 2019</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><a id="more"></a>

<h1 id="MySQL-版本类问题"><a href="#MySQL-版本类问题" class="headerlink" title="MySQL 版本类问题"></a><strong>MySQL 版本类问题</strong></h1><hr>
<h2 id="为什么选择某一-MySQL-版本？"><a href="#为什么选择某一-MySQL-版本？" class="headerlink" title="为什么选择某一 MySQL 版本？"></a><strong>为什么选择某一 MySQL 版本？</strong></h2><hr>
<h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a><strong>知识点</strong></h3><ul>
<li>MySQL常见的发行版本</li>
<li>各个发行版之间的区别及优缺点</li>
</ul>
<h3 id="MySQL-常见的发行版本"><a href="#MySQL-常见的发行版本" class="headerlink" title="MySQL 常见的发行版本"></a><strong>MySQL 常见的发行版本</strong></h3><ul>
<li>MySQL 官方版本（社区版与企业版）</li>
<li>Percona MySQL 版本（在官方版本上进行二次开发，与官方版本兼容，性能优于社区版，但版本较为落后）</li>
<li>MariaDB 版本（与官方版本不完全兼容）</li>
</ul>
<h3 id="各个发行版之间的区别及优缺点"><a href="#各个发行版之间的区别及优缺点" class="headerlink" title="各个发行版之间的区别及优缺点"></a><strong>各个发行版之间的区别及优缺点</strong></h3><p>服务器特性方面：<br><img src="/images/mysql_1.png" alt="mysql_1"></p>
<p>可用性方面：<br><img src="/images/mysql_2.png" alt="mysql_2"></p>
<p>安全特性：<br><img src="/images/mysql_3.png" alt="mysql_3"></p>
<p>开发及管理：<br><img src="/images/mysql_4.png" alt="mysql_4"></p>
<h2 id="如何对-MySQL-进行升级？"><a href="#如何对-MySQL-进行升级？" class="headerlink" title="如何对 MySQL 进行升级？"></a><strong>如何对 MySQL 进行升级？</strong></h2><hr>
<h3 id="知识点-1"><a href="#知识点-1" class="headerlink" title="知识点"></a><strong>知识点</strong></h3><ul>
<li>在对 MySQL 进行升级前需要考虑什么？</li>
<li>MySQL 的升级步骤。</li>
</ul>
<h3 id="在对-MySQL-进行升级前需要考虑什么？"><a href="#在对-MySQL-进行升级前需要考虑什么？" class="headerlink" title="在对 MySQL 进行升级前需要考虑什么？"></a><strong>在对 MySQL 进行升级前需要考虑什么？</strong></h3><ul>
<li>升级可以给业务带来的益处。<ul>
<li>是否可以解决业务上某一方面的痛点。</li>
<li>是否可以解决运维上某一方面的痛点。</li>
</ul>
</li>
<li>升级可能对业务带来的影响。<ul>
<li>对原业务程序的支持是否有影响。</li>
<li>对原业务程序的性能是否有影响。</li>
</ul>
</li>
<li>数据库升级方案的制定。<ul>
<li>评估受影响的业务系统。</li>
<li>制定详细的升级步骤。</li>
<li>升级后的数据库环境检查。</li>
<li>升级后的业务检查。</li>
</ul>
</li>
<li>升级失败的回滚方案。<ul>
<li>制定升级失败的回滚步骤。</li>
<li>回滚后的数据库环境检查。</li>
<li>回滚后的业务检查。</li>
</ul>
</li>
</ul>
<h3 id="数据库升级的一般步骤（主从服务器滚动升级）："><a href="#数据库升级的一般步骤（主从服务器滚动升级）：" class="headerlink" title="数据库升级的一般步骤（主从服务器滚动升级）："></a><strong>数据库升级的一般步骤（主从服务器滚动升级）：</strong></h3><ol>
<li>对待升级数据库进行备份；</li>
<li>升级 Slave 服务器版本；</li>
<li>手动进行主从切换；</li>
<li>升级 Master 服务器版本；</li>
<li>升级完成后进行业务检查。</li>
</ol>
<h2 id="最新的-MySQL-版本及其新特性"><a href="#最新的-MySQL-版本及其新特性" class="headerlink" title="最新的 MySQL 版本及其新特性"></a><strong>最新的 MySQL 版本及其新特性</strong></h2><hr>
<h3 id="知识点-2"><a href="#知识点-2" class="headerlink" title="知识点"></a><strong>知识点</strong></h3><ul>
<li>MySQL 8.0 版本主要的新特性</li>
</ul>
<h3 id="MySQL-8-0-版本的新特性"><a href="#MySQL-8-0-版本的新特性" class="headerlink" title="MySQL 8.0 版本的新特性"></a><strong>MySQL 8.0 版本的新特性</strong></h3><p>服务器功能方面：<br><img src="/images/mysql_5.png" alt="mysql_5"></p>
<p>用户及安全方面：<br><img src="/images/mysql_6.png" alt="mysql_6"></p>
<p>InnoDB 功能方面：<br><img src="/images/mysql_7.png" alt="mysql_7"></p>
<p><strong>资源管理组</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看资源管理组帮助</span></span><br><span class="line">\h <span class="keyword">CREATE</span> <span class="keyword">RESOURCE</span> <span class="keyword">GROUP</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前资源组</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> information_schema.resource_groups;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给某一进程设置资源组</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">RESOURCE</span> <span class="keyword">GROUP</span> rg_name <span class="keyword">for</span> thread_id;</span><br></pre></td></tr></table></figure>

<h1 id="MySQL-用户管理类问题"><a href="#MySQL-用户管理类问题" class="headerlink" title="MySQL 用户管理类问题"></a><strong>MySQL 用户管理类问题</strong></h1><hr>
<h2 id="如何在给定场景下为某用户授权？"><a href="#如何在给定场景下为某用户授权？" class="headerlink" title="如何在给定场景下为某用户授权？"></a><strong>如何在给定场景下为某用户授权？</strong></h2><hr>
<h3 id="知识点-3"><a href="#知识点-3" class="headerlink" title="知识点"></a><strong>知识点</strong></h3><ul>
<li>如何定义 MySQL 数据库账号？</li>
<li>MySQL 常用的用户权限。</li>
<li>如何为用户授权？</li>
</ul>
<h3 id="如何定义一个-MySQL-账号？"><a href="#如何定义一个-MySQL-账号？" class="headerlink" title="如何定义一个 MySQL 账号？"></a><strong>如何定义一个 MySQL 账号？</strong></h3><ul>
<li>用户名@可访问控制列表<ul>
<li>%：代表可以从所有<strong>外部主机</strong>访问；</li>
<li>192.168.1.%：表示可以从 192.168.1 网段访问；</li>
<li>localhost：DB <strong>服务器本地</strong>访问。</li>
</ul>
</li>
<li>使用 <code>CREATE USER</code> 命令创建用户</li>
</ul>
<h3 id="MySQL-常用的用户权限"><a href="#MySQL-常用的用户权限" class="headerlink" title="MySQL 常用的用户权限"></a><strong>MySQL 常用的用户权限</strong></h3><p><img src="/images/mysql_8.png" alt="mysql_8"></p>
<p><img src="/images/mysql_9.png" alt="mysql_9"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看权限列表</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure>

<h3 id="如何为用户授权？"><a href="#如何为用户授权？" class="headerlink" title="如何为用户授权？"></a><strong>如何为用户授权？</strong></h3><ul>
<li>遵循最小权限原则</li>
<li>使用 <code>GRANT</code> 命令对用户授权，<code>REVOKE</code> 收回用户权限</li>
</ul>
<h2 id="如何保证数据库账号的安全？"><a href="#如何保证数据库账号的安全？" class="headerlink" title="如何保证数据库账号的安全？"></a>如何保证数据库账号的安全？</h2><hr>
<h3 id="知识点-4"><a href="#知识点-4" class="headerlink" title="知识点"></a><strong>知识点</strong></h3><ul>
<li>数据库用户管理流程规范</li>
<li>密码管理策略</li>
</ul>
<h3 id="数据库用户管理流程规范"><a href="#数据库用户管理流程规范" class="headerlink" title="数据库用户管理流程规范"></a><strong>数据库用户管理流程规范</strong></h3><ul>
<li>最小权限原则</li>
<li>密码强度策略</li>
<li>密码过期原则</li>
<li>限制历史密码重用原则</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个用户，密码策略为：更改的密码不能为历史密码</span></span><br><span class="line">root&gt; CREATE USER user_name@IP IDENTIFIED BY '123456' PASSWORD HISTORY 1;</span><br><span class="line"></span><br><span class="line">root&gt; SELECT * FROM MYSQL.USER where user='user_name'\G    //查看新创建的用户</span><br><span class="line">root&gt; ALTER USER user_name@IP PASSWORD EXPIRE;      //设置用户密码过期</span><br><span class="line"></span><br><span class="line">user_name&gt; ALTER USER USER() IDENTIFIED BY '123456';    //使用原密码进行重置密码会报错</span><br></pre></td></tr></table></figure>

<h2 id="如何从一个实例迁移数据库账号到另一个实例？"><a href="#如何从一个实例迁移数据库账号到另一个实例？" class="headerlink" title="如何从一个实例迁移数据库账号到另一个实例？"></a><strong>如何从一个实例迁移数据库账号到另一个实例？</strong></h2><hr>
<h3 id="解决思路"><a href="#解决思路" class="headerlink" title="解决思路"></a><strong>解决思路</strong></h3><p><img src="/images/mysql_10.png" alt="mysql_10"></p>
<h3 id="导出用户建立及授权语句"><a href="#导出用户建立及授权语句" class="headerlink" title="导出用户建立及授权语句"></a><strong>导出用户建立及授权语句</strong></h3><ul>
<li><code>pt-show-grants u=root,p=password,h=localhost</code></li>
</ul>
<h1 id="MySQL-服务器配置类问题"><a href="#MySQL-服务器配置类问题" class="headerlink" title="MySQL 服务器配置类问题"></a><strong>MySQL 服务器配置类问题</strong></h1><hr>
<h2 id="请分析一个-GROUP-BY-语句的异常原因"><a href="#请分析一个-GROUP-BY-语句的异常原因" class="headerlink" title="请分析一个 GROUP BY 语句的异常原因"></a><strong>请分析一个 GROUP BY 语句的异常原因</strong></h2><hr>
<p>问题如下：<br><img src="/images/mysql_11.png" alt="mysql_11"></p>
<h3 id="知识点-5"><a href="#知识点-5" class="headerlink" title="知识点"></a><strong>知识点</strong></h3><ul>
<li>SQL MODE 的作用<ul>
<li>配置 MySQL 处理 SQL 的方式，同时也影响 MySQL 对数据校验的严格性</li>
<li><code>SET [session/global/persist] sql_mode=&#39;xxxxx&#39;</code>    // 8.0 版本添加的 <code>persist</code> 参数保证数据库重启后动态设置仍然有效</li>
<li>[mysqld] sql_mode=xxxx</li>
</ul>
</li>
<li>常用的 SQL MODE 值<ul>
<li><code>ONLY_FULL_GROUP_BY</code>：对于 GROUP BY 的聚合操作，如果出现在 SELECT 中的列、HAVING 或者 ORDER BY 子句的非聚合列，没有在 GROUP BY 中出现，那么这个 SQL 语法检查报错；</li>
<li><code>ANSI_QUOTES</code>：禁止用双引号来引用字符串；</li>
<li><code>REAL_AS_FLOAT</code>：Real 作为 Float 的同义词；</li>
<li><code>PIPES_AS_CONCAT</code>：将 || 视为字符串的连接操作符而非 或 运算符；</li>
<li><code>STRICT_TRANS_TABLES / STRICT_ALL_TABLES</code>：在事务存储引擎/所有存储引擎上启用严格模式。如果插入语句的数据类型不同（如整型列插入字符串），那么这个 SQL 语法检查报错，而宽松模式下会插入 0，且警告；</li>
<li><code>ERROR_FOR_DIVISION_BY_ZERO</code>：不允许 0 作为除数；</li>
<li><code>NO_AUTO_CREATE_USER</code>：在用户不存在时，不允许 <code>grant</code> 语句自动建立用户；</li>
<li><code>NO_ZERO_IN_DATE / NO_ZERO_DATE</code>：日期数据内/日期数据不能包含 0；</li>
<li><code>NO_ENGINE_SUBSTITUTION</code>：当指定的存储引擎不可用时报错。</li>
</ul>
</li>
</ul>
<h2 id="如何比较系统运行配置和配置文件中的配置是否一致？"><a href="#如何比较系统运行配置和配置文件中的配置是否一致？" class="headerlink" title="如何比较系统运行配置和配置文件中的配置是否一致？"></a><strong>如何比较系统运行配置和配置文件中的配置是否一致？</strong></h2><hr>
<h3 id="知识点-6"><a href="#知识点-6" class="headerlink" title="知识点"></a><strong>知识点</strong></h3><ul>
<li>使用 <code>SET</code> 命令配置动态参数</li>
<li>使用 <code>pt-config-diff</code> 工具比较配置文件</li>
</ul>
<h3 id="使用-SET-命令配置动态参数"><a href="#使用-SET-命令配置动态参数" class="headerlink" title="使用 SET 命令配置动态参数"></a><strong>使用 SET 命令配置动态参数</strong></h3><ul>
<li><code>SET [session | @@session.] system_var_name = expr</code></li>
<li><code>SET [global | @@global.] system_var_name = expr</code></li>
<li><code>SET [persist | @@persist.] system_var_name = expr</code>    (MySQL 8.0 中新增功能，通过自动创建 <strong>mysqld-auto.cnf</strong> 文件，保证重启不丢失全局修改)</li>
</ul>
<h3 id="比较系统运行配置和配置文件中的配置"><a href="#比较系统运行配置和配置文件中的配置" class="headerlink" title="比较系统运行配置和配置文件中的配置"></a><strong>比较系统运行配置和配置文件中的配置</strong></h3><ul>
<li><code>pt-config-diff u=root,p=password,h=localhost /etc/my.cnf</code></li>
</ul>
<p><img src="/images/mysql_12.png" alt="mysql_12"></p>
<h2 id="举几个-MySQL-中的关键性能参数"><a href="#举几个-MySQL-中的关键性能参数" class="headerlink" title="举几个 MySQL 中的关键性能参数"></a><strong>举几个 MySQL 中的关键性能参数</strong></h2><hr>
<h3 id="知识点-7"><a href="#知识点-7" class="headerlink" title="知识点"></a><strong>知识点</strong></h3><p>常用的性能参数：</p>
<ul>
<li>服务器配置参数：<ul>
<li><code>max_connections</code>：设置 MySQL 允许访问的最大连接数量；</li>
<li><code>interactive_timeout</code>：设置交互连接的 timeout 时间；</li>
<li><code>wait_timeout</code>：设置非交互连接的 timeout 时间；</li>
<li><code>max_allowed_packet</code>：控制 MySQL 可以接收的数据包的大小；</li>
<li><code>sync_binlog</code>：表示每写多少次缓冲会向磁盘同步一次 binlog。对于 master，最好设置为 1；</li>
<li><code>sort_buffer_size</code>：设置每个会话使用的排序缓存区的大小；</li>
<li><code>join_buffer_size</code>：设置每个会话使用的连接缓冲的大小；</li>
<li><code>read_buffer_size</code>：指定了当对一个 MYISAM 进行表扫描时所分配的读缓存池的大小，一般是 4K 的倍数；</li>
<li><code>read_rnd_buffer_size</code>：设置控制索引缓冲区的大小；</li>
<li><code>binlog_cache_size</code>：设置每个会话用于缓存未提交的事务缓存大小；</li>
</ul>
</li>
<li>存储引擎参数：<ul>
<li><code>innodb_flush_log_at_trx_commit</code>：0：每秒进行一次重做日志的磁盘刷新操作；1：每次事务提交都会刷新事务日志到磁盘中；2：每次事务提交写入系统缓存每秒向磁盘刷新一次；</li>
<li><code>innodb_buffer_pool_size</code>：设置 InnoDB 缓冲池的大小，应为系统可用内存的 75%；</li>
<li><code>innodb_buffer_pool_instances</code>：InnoDB 缓冲池的实例个数。一般每个实例大小 1G 左右；</li>
<li><code>innodb_file_per_table</code>：设置每个表独立使用一个表空间文件</li>
</ul>
</li>
</ul>
<h1 id="MySQL-日之类问题"><a href="#MySQL-日之类问题" class="headerlink" title="MySQL 日之类问题"></a><strong>MySQL 日之类问题</strong></h1><hr>
<h2 id="常用的-MySQL-日志有哪些？我们在什么情况下使用这些日志？"><a href="#常用的-MySQL-日志有哪些？我们在什么情况下使用这些日志？" class="headerlink" title="常用的 MySQL 日志有哪些？我们在什么情况下使用这些日志？"></a><strong>常用的 MySQL 日志有哪些？我们在什么情况下使用这些日志？</strong></h2><hr>
<h3 id="知识点-8"><a href="#知识点-8" class="headerlink" title="知识点"></a><strong>知识点</strong></h3><ul>
<li>MySQL 常用的日志类型</li>
<li>各种日志的配置和使用场景</li>
</ul>
<h3 id="MySQL-常用的日志类型"><a href="#MySQL-常用的日志类型" class="headerlink" title="MySQL 常用的日志类型"></a><strong>MySQL 常用的日志类型</strong></h3><ul>
<li><code>error_log</code>：错误日志。记录 MySQL 在启动、运行或停止时出现的问题。</li>
<li><code>general_log</code>：常规日志。记录所有发向 MySQL 的请求。</li>
<li><code>slow_query_log</code>：慢查日志。记录符合条件的查询。</li>
<li><strong><code>binary_log</code></strong>：二进制日志。记录全部有效的数据修改日志。</li>
<li><code>relay_log</code>：中继日志。用于主从复制，临时存储从主库同步的二进制日志。</li>
</ul>
<h3 id="各种日志的配置和使用场景"><a href="#各种日志的配置和使用场景" class="headerlink" title="各种日志的配置和使用场景"></a><strong>各种日志的配置和使用场景</strong></h3><p><strong>错误日志</strong></p>
<ul>
<li>使用场景<ul>
<li>分析排除 MySQL 运行错误</li>
<li>记录未经授权的访问</li>
</ul>
</li>
<li>配置参数<ul>
<li><code>log_error = $mysql/sql_log/mysql-error.log</code>(最好和数据目录分开存储)</li>
<li><code>log_error_verbosity = [1, 2, 3]</code>：设定错误日志中记录错误信息的级别（默认2）。1：error messages；2：Error and warning messages；3：Error, warning and note messages。</li>
<li><code>log_error_services = [日志服务组件；日志服务组件]</code>：8.0新增参数。定义MySQL 如何把错误信息写入到错误日志中的。常用的 MySQL 日志服务组件如下：<ul>
<li><code>log_filter_internal</code>：默认的日志过滤组件，依赖 <code>log_error_verbosity</code>；</li>
<li><code>log_sink_internal</code>：默认的日志输出组件，依赖 <code>log_error</code>；</li>
<li><code>log_sink_json</code>：将错误日志输出到 json 文件；</li>
<li><code>log_sink_syseventlog</code>：将错误日志输出到系统日志文件。</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @@log_error;    // 查看当前错误日志文件</span><br><span class="line"><span class="keyword">SELECT</span> @@log_error_verbosity;    // 查看当前错误日志级别</span><br><span class="line"><span class="keyword">SELECT</span> @@log_error_services;      // 8.0新增功能</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSTALL</span> component <span class="string">'file://component_log_sink_json'</span>;    // 安装日志服务组件</span><br></pre></td></tr></table></figure>

<p><strong>常规日志</strong></p>
<ul>
<li>应用场景<ul>
<li>分析客户端发送到 MySQL 的实际请求（包括语法错误请求）；</li>
</ul>
</li>
<li>配置参数<ul>
<li><code>general_log = [ON|OFF]</code>：打开或关闭常规日志（默认关闭）；</li>
<li><code>general_log_file = $mysql/sql_log/general.log</code>：设定常规日志存储文件；</li>
<li><code>log_output = [FILE|TABLE|NONE]</code>：设定保存形式（默认为文件）。</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">global</span> general_log=<span class="keyword">ON</span>;    // 打开常规日志功能</span><br><span class="line"></span><br><span class="line">tail -f path/to/general_log/file    // 跟踪显示日志内容</span><br><span class="line"></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">table</span> general_log;      // 清空 general_log 表</span><br></pre></td></tr></table></figure>

<p><strong>慢查日志</strong></p>
<ul>
<li>应用场景<ul>
<li>将执行成功并符合条件的查询记录到日志中；</li>
<li>找到需要优化的 SQL；</li>
</ul>
</li>
<li>配置参数<ul>
<li><code>slow_query_log = [ON|OFF]</code>：默认关闭；</li>
<li><code>slow_query_log_file = $mysql/sql_log/slowlog.log</code></li>
<li><code>long_query_time = xx秒</code>：记录条件之一：查询时间超过设定阈值；</li>
<li><code>log_query_not_using_indexes = [ON|OFF]</code>：记录条件之一：查询没有使用索引。默认关闭；</li>
<li><code>log_slow_admin_statements = [ON|OFF]</code>：记录管理命令；</li>
<li><code>log_slow_slave_statements = [ON|OFF]</code></li>
</ul>
</li>
</ul>
<p><strong>二进制日志</strong></p>
<ul>
<li>应用场景<ul>
<li>记录所有对数据库中数据的修改（只会记录修改成功的修改语句）</li>
<li>基于时间点的备份和恢复</li>
<li>实现主从复制</li>
</ul>
</li>
<li>配置参数（重要参数）<ul>
<li><code>log_bin [= base_name]</code>：<strong>静态参数</strong>。base_name 为二进制日志文件名的前缀，后缀是系统自动生成的递增序列。</li>
<li><code>binlog_format = [ROW | STATEMENT | MIXED]</code>：配置格式（默认为ROW）。ROW是针对行修改进行记录。如，一条语句修改了10行数据，则会记录10条记录，避免了主从不一致的现象。</li>
<li><code>binlog_row_image = [FULL | MINIMAL | NOBLOB]</code>：定义ROW格式记录的方式，默认为FULL，即记录所有列修改前和修改后的值（没修改列的也会记录）。MINIMAL只记录修改列的值。NOBLOB记录所有除了BLOB列的所有列的修改前和修改后的值。</li>
<li><code>binlog_rows_query_log_events = [ON | OFF]</code>：在ROW格式下记录实际的SQL执行语句，默认关闭。</li>
<li><code>log_slave_updates = [ON | OFF]</code>：记录从主服务器传过来的二进制日志数据，默认OFF；</li>
<li><code>sync_binlog = [1 | 0]</code>：控制MySQL如何刷新二进制日志到磁盘，默认1。1：每写一次二进制日志就刷新到磁盘；0：不会主动刷新二进制日志到磁盘，而是由操作系统决定。</li>
<li><code>expire_logs_days = days</code>：设定二进制日志过期时间，系统定期清理；</li>
<li><code>PURGE BINARY LOGS TO &#39;mysql-bin.010&#39;;</code>：手动清理010前的所有二进制日志文件（如有条件，做备份）；</li>
<li><code>PURGE BINARY LOGS BEFORE &#39;2008-04-02 22:46:26&#39;;</code>：手动清理该时间以前的所有二进制日志文件；</li>
</ul>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 查看二进制文件内容，实际记录的内容与实际执行的语句并不相同</span><br><span class="line">mysqlbinlog --no-defaults -vv --base64-output=DECODE-ROWS binlog/file</span><br></pre></td></tr></table></figure>

<p><strong>中继日志</strong></p>
<ul>
<li>使用场景<ul>
<li>临时记录从主服务器同步的二进制日志</li>
</ul>
</li>
<li>配置参数<ul>
<li><code>relay_log = filename</code>：指定存放位置和文件名的前缀；</li>
<li><code>relay_log_purge = [ON | OFF]</code>：是否进行自动清理，默认ON。</li>
</ul>
</li>
</ul>
<h2 id="如何通过日志来审计用户活动？"><a href="#如何通过日志来审计用户活动？" class="headerlink" title="如何通过日志来审计用户活动？"></a><strong>如何通过日志来审计用户活动？</strong></h2><hr>
</div><div class="post-copyright"><blockquote><p>原文作者: lixh</p><p>原文链接: <a href="http://yoursite.com/2019/08/30/MySQL面试指南_笔记一/">http://yoursite.com/2019/08/30/MySQL面试指南_笔记一/</a></p><p>版权声明: 转载请注明出处(必须保留原文作者署名原文链接)</p></blockquote></div><div class="tags"><a href="/tags/MySQL/">MySQL</a></div><div class="post-share"><div class="social-share"><span>分享到:</span></div></div><div class="post-nav"><a href="/2019/08/31/MySQL面试指南_笔记二/" class="pre">MySQL面试指南_笔记二</a><a href="/2019/08/22/算法Python_排序和搜索/" class="next">算法Python_排序与搜索</a></div><div id="comments"><div id="container"><script type="text/javascript" src="https://unpkg.com/gitalk/dist/gitalk.min.js?v=2.0.4"></script><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=2.0.4"></script><script>var gitalk = new Gitalk({
  clientID: '797d74e1958a846713d9',
  clientSecret: '2bab30fb152aaf3d7f61a916fbe04135e950f57f',
  repo: 'Mr-lixh.github.io',
  owner: 'Mr-lixh',
  admin: ['Mr-lixh'],
  id: md5(window.location.pathname),
  distractionFreeMode: false,
  language: 'zh-CN',
  pagerDirection: 'last'
})
gitalk.render('container')</script></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-版本类问题"><span class="toc-text">MySQL 版本类问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#为什么选择某一-MySQL-版本？"><span class="toc-text">为什么选择某一 MySQL 版本？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#知识点"><span class="toc-text">知识点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL-常见的发行版本"><span class="toc-text">MySQL 常见的发行版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#各个发行版之间的区别及优缺点"><span class="toc-text">各个发行版之间的区别及优缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何对-MySQL-进行升级？"><span class="toc-text">如何对 MySQL 进行升级？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#知识点-1"><span class="toc-text">知识点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在对-MySQL-进行升级前需要考虑什么？"><span class="toc-text">在对 MySQL 进行升级前需要考虑什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据库升级的一般步骤（主从服务器滚动升级）："><span class="toc-text">数据库升级的一般步骤（主从服务器滚动升级）：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#最新的-MySQL-版本及其新特性"><span class="toc-text">最新的 MySQL 版本及其新特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#知识点-2"><span class="toc-text">知识点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL-8-0-版本的新特性"><span class="toc-text">MySQL 8.0 版本的新特性</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-用户管理类问题"><span class="toc-text">MySQL 用户管理类问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#如何在给定场景下为某用户授权？"><span class="toc-text">如何在给定场景下为某用户授权？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#知识点-3"><span class="toc-text">知识点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何定义一个-MySQL-账号？"><span class="toc-text">如何定义一个 MySQL 账号？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL-常用的用户权限"><span class="toc-text">MySQL 常用的用户权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何为用户授权？"><span class="toc-text">如何为用户授权？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何保证数据库账号的安全？"><span class="toc-text">如何保证数据库账号的安全？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#知识点-4"><span class="toc-text">知识点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据库用户管理流程规范"><span class="toc-text">数据库用户管理流程规范</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何从一个实例迁移数据库账号到另一个实例？"><span class="toc-text">如何从一个实例迁移数据库账号到另一个实例？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#解决思路"><span class="toc-text">解决思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#导出用户建立及授权语句"><span class="toc-text">导出用户建立及授权语句</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-服务器配置类问题"><span class="toc-text">MySQL 服务器配置类问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#请分析一个-GROUP-BY-语句的异常原因"><span class="toc-text">请分析一个 GROUP BY 语句的异常原因</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#知识点-5"><span class="toc-text">知识点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何比较系统运行配置和配置文件中的配置是否一致？"><span class="toc-text">如何比较系统运行配置和配置文件中的配置是否一致？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#知识点-6"><span class="toc-text">知识点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用-SET-命令配置动态参数"><span class="toc-text">使用 SET 命令配置动态参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#比较系统运行配置和配置文件中的配置"><span class="toc-text">比较系统运行配置和配置文件中的配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#举几个-MySQL-中的关键性能参数"><span class="toc-text">举几个 MySQL 中的关键性能参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#知识点-7"><span class="toc-text">知识点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-日之类问题"><span class="toc-text">MySQL 日之类问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#常用的-MySQL-日志有哪些？我们在什么情况下使用这些日志？"><span class="toc-text">常用的 MySQL 日志有哪些？我们在什么情况下使用这些日志？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#知识点-8"><span class="toc-text">知识点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MySQL-常用的日志类型"><span class="toc-text">MySQL 常用的日志类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#各种日志的配置和使用场景"><span class="toc-text">各种日志的配置和使用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何通过日志来审计用户活动？"><span class="toc-text">如何通过日志来审计用户活动？</span></a></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/10/16/面试_Java知识点/">面试_Java知识点</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/14/面试_计算机网络知识点/">面试_计算机网络知识点</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/14/面试_Spring框架知识点/">面试_Spring框架知识点</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/13/面试_Spring知识点/">面试_Spring知识点</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/13/面试_线程知识点整理/">面试_线程知识点整理</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/13/面试_MySQL优化/">面试_MySQL优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/13/面试_JVM面试问题整理/">面试_JVM面试问题整理</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/11/Spring框架/">Spring框架</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/24/Docker的一些整理/">Docker的一些整理</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/09/22/Python数据分析6_模型评估/">Python数据分析6_模型评估</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/开发/" style="font-size: 15px;">开发</a> <a href="/tags/数据分析/" style="font-size: 15px;">数据分析</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/虚拟化/" style="font-size: 15px;">虚拟化</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://github.com/Mr-lixh" title="github" target="_blank">github</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span> Copyright &copy;<a href="/." rel="nofollow">lixh.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?13549e9998ed36aa1cfcbd1ebe61afe0";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/search.json.js?v=2.0.4"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.4" async></script><link rel="stylesheet" type="text/css" href="/share/css/share.css"><script type="text/javascript" src="/share/js/social-share.js" charset="utf-8"></script><script type="text/javascript" src="/share/js/qrcode.js" charset="utf-8"></script></body></html>